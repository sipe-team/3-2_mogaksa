# 2주차 : 최대한 적은돈으로 효율적인 서버환경을 구성 및 비교

앞서 말한 간단한 구조로 컨테이너로 된 백엔드 서버 하나를 구성 했습니다. 

ECR에 이미지를 올리고 ECS로 컨테이너를 실행하고 RDS로 데이터베이스를 활용하며

Lambda로 부가적인 로직들을 작성했으며 

SQS로 메세지를 던질때 Lambda가 호출되는 비동기적 구성으로 해보았습니다.

일단 EC2라는 VM에 직접 서버를 올리는 것보다 '컨테이너화'가 되어있으면 컨테이너 오케스트레이션 플랫폼 위에서 서버를 돌리는게 효율적이다라는 생각을 가지고 있습니다. 그래서 ECS를 활용했습니다.

나머진 그렇게 이슈가 없었는데 ECS가 일단 배포가 매우느린게 문제가 되었습니다. 기존 로컬에서 빌드 및 실행했을 때(스프링부트 기준) 10초이내로 실행 되던 것이

ECS에서 130초가 걸렸으며 어플리케이션 실행되는 시간을 제외하고도 CICD를 신경쓰지 않으면 컨테이너가 ECS에 새로 배포되는 데에 '20분'이 넘게 걸렸습니다!

CICD 배포 레벨에서 시간을 줄이기 위해선 wait-for-service-stability 옵션을 false 설정하면 빨라진다고 해서 설정 후 배포시간은 2분이내로 줄었습니다.

## 어플리케이션 실행타임과 헬스체크의 중요성

배포시간은 줄였지만 어플리케이션이 실행되는 시간은 상당히 길었는데 (프리티어로 싼 DB를 써서 아마 커넥션 맺을때 오래걸리는거 같다) 130초는 여전했습니다.

하지만 기본 로드밸런서의 헬스체크 타임아웃 시간이 60에 3회 실패 반복이기에 가끔 헬스체크에 실패했다며 컨테이너를 죽이고 띄우는 동작을 반복하였습니다.

그래서 헬스체크시간을 150초로 넉넉히 설정했으며 그로 인해 서버가 안정적이게 배포되고 운영될 수 있게 되었습니다.

